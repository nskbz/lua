# Lua
《自己动手实现Lua》学习，完成于2025.8.8

Lua 中的函数是一等公民(first-class values)，这意味着：
1. 函数可以存储在变量中
2. 函数可以作为参数传递给其他函数
3. 函数可以作为其他函数的返回值
4. 函数可以在运行时动态创建

完整地跟了一遍代码,算是学习go后的第一个完整项目,也有7000行代码量了。实现过程我总结为几个阶段：
1. Vm解释器阶段
    先是利用luac命令生成解释器能执行的二进制文件,将其作为输入,然后解析为ProtoType再生成对应的vm虚拟机(我是感觉可以类比为进程,相关资源全在该vm中),然后执行vm就能获取对应的输出。每一个Vm实例中都有一个寄存器栈,用于存放操作数,中间结果,以及返回值。这一阶段的关键是vm如何根据ProtoType给的指令正确执行并获取期望的输出!为此根据Lua官方给的指令功能将其翻译成对应的handler,利用栈和go基础库的能力实现指令功能。
2. 编译器阶段
    此时已经有了能够解释LUA指令标准的Vm了,如何打通原文件到ProtoType的流程就是该阶段的关注点。整个编译阶段囊括为三个步骤：词法分析->语法分析->代码生成(最终ProtoType)

    词法分析主要是提取源代码中的token,单独的token都是无意义的,后续语法分析才能将离散的token组合成有意义的语句。语法分析最主要就是生成了抽象语法树(AST),为后续的代码生成提供信息。代码生成则是通过AST生成ProtoType,即根据AST生成对应的LUA标准指令。
    其中词法分析和语法分析属于编译器前端(负责处理与源语言相关的任务，将源代码转换为中间表示),代码生成属于编译器后端(负责处理与目标机器相关的任务，将中间表示转换为目标代码)。
3. 扩展库阶段
    完成Vm和Compiler后,一门解释型语言的雏形也就完成了,但为了这门语言使用更方便,我们应当为其提供一些基础库。此阶段我并没有将所有库都进行了实现,有些库也只是象征性的实现了几个方法!